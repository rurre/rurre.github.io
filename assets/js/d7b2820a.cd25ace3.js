"use strict";(self.webpackChunkrurre_github_io=self.webpackChunkrurre_github_io||[]).push([[515],{2631:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"warudo-exporter/technical-details","title":"Technical Details","description":"All the nerdy technical details of how things work.","source":"@site/docs/warudo-exporter/technical-details.md","sourceDirName":"warudo-exporter","slug":"/warudo-exporter/technical-details","permalink":"/docs/warudo-exporter/technical-details","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"description":"All the nerdy technical details of how things work.","sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"Usage","permalink":"/docs/warudo-exporter/usage"}}');var o=n(4848),i=n(8453);const a={description:"All the nerdy technical details of how things work.",sidebar_position:10},r="Technical Details",d={},l=[{value:"NDMF Plugin",id:"ndmf-plugin",level:2},{value:"Harmony Patching the Bundle Export",id:"harmony-patching-the-bundle-export",level:2},{value:"Unity 2021-2022 and Constraints",id:"unity-2021-2022-and-constraints",level:2},{value:"Harmony Patching UMod to Include External Scripts",id:"harmony-patching-umod-to-include-external-scripts",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"technical-details",children:"Technical Details"})}),"\n",(0,o.jsx)(t.p,{children:"Ok so how does all this even work? Here's a bunch of nerdy technical details going over how thigns work, the issues I faced, and how I resolved them."}),"\n",(0,o.jsx)(t.h2,{id:"ndmf-plugin",children:"NDMF Plugin"}),"\n",(0,o.jsxs)(t.p,{children:["Most of the changes done to our avatar are done by a custom NDMF plugin. There's a bunch of different passes that all do their own things. You can read more about what they are what they do in ",(0,o.jsx)(t.a,{href:"./features",children:"Features"})]}),"\n",(0,o.jsx)(t.h2,{id:"harmony-patching-the-bundle-export",children:"Harmony Patching the Bundle Export"}),"\n",(0,o.jsx)(t.p,{children:"Mismatching Unity asset bundle versions isn't necessarly an issue, after all, VRChat has been doing it for years...\r\nIt supports older uploads from versions such as Unity 2019 on it's newer Unity 2022 just fine, at least for now."}),"\n",(0,o.jsx)(t.p,{children:"It makes sense that Unity would have some asset bundle backwards compatibility built in, or at least documented and accounted for. It also makes sense for it to not work the other way around."}),"\n",(0,o.jsx)(t.p,{children:"So what do I actually do to make bundles built in Unity 2022 work? Not much actually. It turns out that, all UMod (the modding framework Warudo uses) does to check if a bundle should be loaded, is a Unity version string inside the mod bundle itself. Yep, that's really it."}),"\n",(0,o.jsx)(t.p,{children:"I patch the method that gets the Unity version to store inside the bundle to always return the target Unity version that Warudo uses, in this case Unity 2021. And, by sheer luck, it all loads and works almost flawlesly."}),"\n",(0,o.jsx)(t.h2,{id:"unity-2021-2022-and-constraints",children:"Unity 2021-2022 and Constraints"}),"\n",(0,o.jsxs)(t.p,{children:["When I said almost flawlessly, I meant that I personally only ran into some issues. One of these issues is that constraints export deactivated. This is because between Unity 2021 and 2021, the active property of constraints was renamed from ",(0,o.jsx)(t.code,{children:"m_IsContraintActive"})," (misspelled) to ",(0,o.jsx)(t.code,{children:"m_Active"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"This isn't an issue when newer versions of Unity read this property on something like a Prefab, because Unity keeps track of property changes and accounts for them for backwards compatibility. In case of forward compatibility, the property is not recognised and ignored."}),"\n",(0,o.jsx)(t.p,{children:"So, to fix this I run an NDMF pass that attaches a simple script to all objects with Constraints on them. This script enables the Constraint on Start() then removes itself. It also (non-destructively) modifies all animation clips that use the new name to use the old one instead, making the animation work correctly in either version of Unity."}),"\n",(0,o.jsx)(t.h2,{id:"harmony-patching-umod-to-include-external-scripts",children:"Harmony Patching UMod to Include External Scripts"}),"\n",(0,o.jsx)(t.p,{children:"For this usecase, UMod has a very annoying limitation. It only includes files inside your mod's export folder in it's mod builds, so to include this script, that's meant to be uploaded on multiple avatars, in every avatar mod export, I would need to either duplicate and rename a copy to put into every export folder (causing script recompiles), or move the single script around every mod folder when a build needs to happen. Sounds reasonable, but in case of a failure, I could lose track of this script and the whole feature would stop working."}),"\n",(0,o.jsxs)(t.p,{children:["So, what I do instead is harmony patch UMod to include scripts into it's mod build from ",(0,o.jsx)(t.em,{children:"anywhere"}),", if the script is on the avatar (or prop) and if the script is in a folder called ",(0,o.jsx)(t.code,{children:"BuildIncluded"})," or a subfolder of it."]}),"\n",(0,o.jsx)(t.p,{children:"This means we're not getting and stray scripts included if they're unused, and it also means we don't need to worry about duplicating or moving scripts around. It just works\u2122"})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var s=n(6540);const o={},i=s.createContext(o);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);